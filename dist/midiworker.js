(()=>{"use strict";(async()=>{const t=self.location.hash.split("#")[1];console.log(t);const e=await fetch(t),n=await e.arrayBuffer(),{ctrls:{run:s,rwd:r,pause:a},totalTicks:c,presets:o}=await async function(t,e){const{tracks:n,division:s,presets:r,ntracks:a}=function(t){const e=function(t){let e=0;const n=()=>t[e++];function s(){const t=n();return 32==t?" ":t>=65&&t<=122?"ABCDEFGHIJKLMNOPQRSTUVWXYZ......abcdefghijklmnopqrstuvwxyz".split("")[t-65]:t}return{get offset(){return e},set offset(t){e=t},fgetc:n,read32:()=>n()<<24|n()<<16|n()<<8|n(),read24:()=>n()<<16|n()<<8|n(),read16:()=>n()<<8|n(),readVarLength:function(){let t=0,e=n();for(t=127&e;128&e;)e=n(),t=t<<7|127&e;return t},readString:t=>{let e="";for(;t--;)e+=s();return e},btoa:s}}(t),{fgetc:n,btoa:s,read24:r,readString:a,read32:c,readVarLength:o,read16:i}=e,f=([s(),s(),s(),s()].join(""),c(),i(),i()),u=i(),l=[],h=t.byteLength;let d;function p(){const{fgetc:t,read24:n,readString:s,read32:r,readVarLength:a,read16:c}=e;let o=t();if(null==o)return[];if(240==(240&o))switch(o){case 255:return{meta:t(),payload:s(a())};case 240:case 247:return{sysex:s(a())};default:return{type:o,system:s(a())}}else{let e;switch(0==(128&o)?(e=o,o=d):(e=t(),d=o),o>>4){case 12:case 13:return{ch:15&o,cmd:(o>>4).toString(16),channel:[o,e,0]};default:return{ch:15&o,cmd:(o>>4).toString(16),channel:[o,e,t()]}}}}const g=[];for(;e.offset<h;){n(),n(),n(),n();let t=0;const s=c(),r=e.offset+s,a=[];for(;e.offset<r;){const n=o(),s=p();if(!s)break;if(s.eot)break;t+=n,s.channel&&s.channel[0]>>4==12&&g.push({t,channel:15&s.channel[0],pid:127&s.channel[1]});const r={offset:e.offset,t,delay:n,...s};a.push(r)}l.push(a),e.offset=r}return{division:u,tracks:l,ntracks:f,presets:g}}(t),c=s;let o=5e5,i=4,f=0;const u=n.map((t=>t[t.length-1])).reduce(((t,e)=>Math.max(e.t,t)),0),l=[];let h=0,d=0,p=!1;async function g(){for(;h<u;){for(let t in n){const s=n[t];if(s.length)for(;s.length&&s[0].t<h;){const n=s.shift();e(n),l.push({track:t,clockTime:d,...n}),n.tempo&&(o=n.tempo),n.timeSignature&&(i=n.timeSignature[0]/n.timeSignature[1]*4)}}if(p)break;const t=o/1e3/i;await new Promise((e=>setTimeout(e,t))),h+=c/i,d+=t/1e3,f++,e({clockTime:d,qn:f})}}return{ctrls:{pause:function(){p=!0},rwd:function(t){const e=[];for(;l.length&&l[l.unshift()].clockTime>d-t;)e.push(l.pop());for(h=e[0].tick,d-=t;e.length;)n[e[0].track].push(e.shift())},run:g,resume:function(){p=!1,g()}},tracks:n,ntracks:a,presets:r,totalTicks:u}}(new Uint8Array(n),postMessage);postMessage({totalTicks:c,presets:o}),onmessage=({data:{cmd:t,amt:e}})=>{switch(t){case"start":s();break;case"pause":a();break;case"resume":s();break;case"rwd":r(e||16)}}})()})();