(()=>{"use strict";const t=async e=>{const s=await fetch(e),n=await s.arrayBuffer(),{ctrls:{run:r,rwd:a,pause:c},totalTicks:o,tracks:i,presets:f}=await async function(t,e){const{tempos:s,tracks:n,division:r,presets:a,ntracks:c}=function(t){const e=function(t){let e=0;const s=()=>t[e++];function n(){const t=s();return t>=32&&t<=122?" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[~]^_@abcdefghijklmnopqrstuvwxyz".split("")[t-32]:""}return{get offset(){return e},set offset(t){e=t},fgetc:s,read32:()=>s()<<24|s()<<16|s()<<8|s(),read24:()=>s()<<16|s()<<8|s(),read16:()=>s()<<8|s(),readVarLength:function(){let t=0,e=s();for(t=127&e;128&e;)e=s(),t=t<<7|127&e;return t},readString:t=>{let e="";for(;t--;)e+=n();return e},btoa:n}}(t),{fgetc:s,btoa:n,read24:r,readString:a,read32:c,readVarLength:o,read16:i}=e,f=([n(),n(),n(),n()].join(""),c(),i(),i()),u=i(),l=[],h=t.byteLength;let d;function p(){const{fgetc:t,read24:s,readString:n,read32:r,readVarLength:a,read16:c}=e;let o=t();if(null==o)return[];if(240==(240&o))switch(o){case 255:{const e=t(),r=a();switch(e){case 81:return{tempo:s()};default:return{meta:e,payload:n(r)}}}case 240:case 247:return{sysex:n(a())};default:return{type:o,system:n(a())}}else{let e;switch(0==(128&o)?(e=o,o=d):(e=t(),d=o),o>>4){case 12:case 13:return{ch:15&o,cmd:(o>>4).toString(16),channel:[o,e,0]};default:return{ch:15&o,cmd:(o>>4).toString(16),channel:[o,e,t()]}}}}const g=[],m=[];for(;e.offset<h;){s(),s(),s(),s();let t=0;const n=c(),r=e.offset+n,a=[];for(;e.offset<h&&e.offset<r;){const s=o(),n=p();if(!n)break;if(n.eot)break;if(t+=s,n.tempo)m.push({t,delay:s,track:a.length,...n});else if(n.channel&&n.channel[0]>>4==12)g.push({t,channel:15&n.channel[0],pid:127&n.channel[1]});else{const r={offset:e.offset,t,delay:s,...n};a.push(r)}}a.length&&l.push(a),e.offset=r}return{division:u,tracks:l,ntracks:f,presets:g,tempos:m}}(t),o=r;let i=5e5,f=4,u=0;const l=n.map((t=>t[t.length-1])).reduce(((t,e)=>Math.max(e.t,t)),0);let h=0,d=0,p=!1;async function g(){for(;h<l;){for(let t in n){const s=n[t];if(s.length)for(;s.length&&s[0].t<h;){const t=s.shift();e(t),t.timeSignature&&(f=t.timeSignature[0]/t.timeSignature[1]*4)}}if(p)break;const t=i/1e3/f;await new Promise((e=>setTimeout(e,t))),h+=o/f,d+=t/1e3,u++,e({clockTime:d,qn:u,tick:h}),h>=s[0].t&&(i=s.shift().tempo,e({tempo:60/(i/1e6)}))}}return{ctrls:{pause:function(){p=!0},rwd:function(t){return!1},run:g,resume:function(){p=!1,g()}},tracks:n,ntracks:c,presets:a,totalTicks:l}}(new Uint8Array(n),postMessage);if(i){postMessage({totalTicks:o,presets:f});for(const t of i)for(const e of t){if(e&&e.t>0)break;e.channel||postMessage(e)}onmessage=({data:{cmd:e,amt:s,url:n,evtPipe:o}})=>{switch(n&&(c(),t(n)),e){case"start":r();break;case"pause":c();break;case"resume":r();break;case"rwd":a(s||16)}}}},e=self.location.hash.split("#")[1];console.log(e),t(e)})();