self.addEventListener("message",(({data:{url:s,smpls:e,destination:t,...o}})=>{console.log(e,s),t?(self.destport=t,self.destport.onmessage=({data:s})=>postMessage(s)):s&&e?async function(s,e,t){let o,a;const n={};e.sort(((s,e)=>s.sampleId<e.sampleId));for(const{range:s}of e)o=o?s[0]<o?s[0]:o:s[0],a=a?s[1]>a?s[1]:a:s[1];for(const{range:s,sampleId:t}of e)n[t]={startByte:s[0]-o,endByte:s[1]-o};const d=await fetch("/sf2rend/file.sf2",{headers:{range:"bytes="+[o,a].join("-")}});t.postMessage({stream:d.body,segments:n,nsamples:(a-o+1)/2},[d.body]),await d.body.close}(0,e,self.destport):o&&self.destport&&self.destport.postMessage(o)}));